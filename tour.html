<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>WebVR - Aframe - VR walkthrough</title>
    <meta name="description" content="WebVR - Aframe - VR walkthrough">
    <meta name="author" content="Kumar Ahir - VR Designer">
    <script src="https://aframe.io/releases/1.0.0/aframe.min.js"></script>
    <!-- <script src="https://unpkg.com/aframe-animation-component@^4.1.2/dist/aframe-animation-component.min.js"></script> -->
    <!-- <script src="https://unpkg.com/aframe-look-at-component@0.5.1/dist/aframe-look-at-component.min.js"></script> -->
    <script>

// Coordinates Script
AFRAME.registerComponent('cursor-position', {
tick() {

 var wpVector = new THREE.Vector3()
 newValue=this.el.object3D.getWorldPosition(wpVector);
 const stringCoords = AFRAME.utils.coordinates.stringify(newValue);
 if (this.lastValue !== stringCoords) {
   this.el.emit('positionChanged', newValue);
   this.lastValue = stringCoords;
 }
},
});

// Hotspots Scripts
      AFRAME.registerComponent('hotspots',{
        init:function(){
            this.el.addEventListener('reloadspots',function(evt){

            //get the entire current spot group and scale it to 0
            var currspotgroup=document.getElementById(evt.detail.currspots);
            currspotgroup.setAttribute("scale","0 0 0");

            //get the entire new spot group and scale it to 1
            var newspotgroup=document.getElementById(evt.detail.newspots);
            newspotgroup.setAttribute("scale","1 1 1");
          });
        }
      });
      AFRAME.registerComponent('spot',{
        schema:{
          linkto:{type:"string",default:""},
          spotgroup:{type:"string",default:""}
        },
        init:function(){

          //add image source of hotspot icon
          this.el.setAttribute("src","#hotspot");
          //make the icon look at the camera all the time
          this.el.setAttribute("look-at","#cam");

          var data=this.data;

          this.el.addEventListener('click',function(){
            //set the skybox source to the new image as per the spot
            var sky=document.getElementById("skybox");
            sky.setAttribute("src",data.linkto);

            var spotcomp=document.getElementById("spots");
            var currspots=this.parentElement.getAttribute("id");
            //create event for spots component to change the spots data
            spotcomp.emit('reloadspots',{newspots:data.spotgroup,currspots:currspots});
          });
        }
      });
    </script>
  </head>
  <body>
    <a-scene background="color: #ECECEC">
      <a-assets>
       <img id="point1" src="assets/360images/broomhall/middle1.jpg"/>
        <img id="point2" src="assets/360images/broomhall_sandpit_1.jpg"/>
        <img id="point3" src="assets/360images/broomhall_easels_1.jpg"/>
        <img id="point4" src="assets/360images/broomhall_playdough_1.jpg"/>
        <img id="point5" src="assets/360images/broomhall_bakingwindow_1.jpg"/>

        <img id="hotspot" src="assets/images/navigation.svg"/>
      </a-assets>

      <a-entity id="spots" hotspots>
        <a-entity id="group-point1">
          <a-image spot="linkto:#point2;spotgroup:group-point2"  position="-0.1699471100147464 1.2494545259466328 1.7573377166664161" scale="0.3 0.3 0.3"></a-image>
          <a-entity text="value: Sand Pit;" position="-0.42887142626522334 1.3203375397590293 1.7256471852801203" scale="10 10 10" rotation="0 88.006 0"></a-entity>
        </a-entity>
        <a-entity id="group-point2" scale="0 0 0">
          <a-image spot="linkto:#point1;spotgroup:group-point1" position="10 0 -8"></a-image>
          <a-image spot="linkto:#point3;spotgroup:group-point3" position="0 0 10"></a-image>
        </a-entity>
        <a-entity id="group-point3" scale="0 0 0">
          <a-image spot="linkto:#point2;spotgroup:group-point2" position="10 0 3"></a-image>
          <a-image spot="linkto:#point4;spotgroup:group-point4" position="-10 0 -3"></a-image>
        </a-entity>
        <a-entity id="group-point4" scale="0 0 0">
          <a-image spot="linkto:#point3;spotgroup:group-point3" position="0 0 -10"></a-image>
        </a-entity>
      </a-entity>

      <a-sky id="skybox" src="#point1" geometry="phi-start:90"></a-sky>

      <a-entity id="cam" camera position="0 1.6 0" look-controls>
        <a-entity cursor="fuse:true;fuseTimeout:2000"
                  geometry="primitive:ring;radiusInner:0.01;radiusOuter:0.02"
                  position="0 0 -1.8"
                  material="shader:flat;color:#ff0000"
                  animation__mouseenter="property:scale;to:3 3 3;startEvents:mouseenter;endEvents:mouseleave;dir:reverse;dur:2000;loop:1"
                  id="cursor"
                  cursor-position
                  >
        </a-entity>
      </a-entity>

    </a-scene>

    <script>
    document.getElementById('cursor')
  .addEventListener('positionChanged', e => {
    console.log('New position:', AFRAME.utils.coordinates.stringify(e.detail));
  });
    </script>


  </body>
</html>
